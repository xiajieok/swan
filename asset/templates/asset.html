{% extends 'base.html' %}
{#{% load custom %}#}
{% block page_header %}
    <h1>
        资产列表
        <small>Optional description</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
        <li class="active">Here</li>
    </ol>
{% endblock %}
{% block content %}
    <div class="alert alert-danger alert-dismissible hidden" id="del_asset">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
        <h4><i class="icon fa fa-check"></i> Success!</h4>
        删除设备成功,5s后自动返回!!!
    </div>
    <div class="modal fade" id="modal-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title" id="myModalLabel">主机详情</h3>
                </div>
                <div class="modal-body detail" style="margin: 10px">
                    <span>
                        主机名:
                        <a id="host"></a>
                    </span>
                    <hr>
                    <p>
                        型号:
                        <a id="product"></a>
                    </p>
                    <hr>
                    <p>
                        SN:
                        <a id="sn"></a>
                    </p>
                    <hr>

                    <p>
                        CPU型号:
                        <a id="cpu_version"></a>
                    </p>
                    <hr>
                    <p>
                        内存:
                        <a id="mem"></a>
                    </p>
                    <hr>
                    <p>
                        磁盘:
                        <a id="disk"></a>
                    </p>
                    <hr>
                    <p>
                        磁盘使用率:
                        <a id="used"></a>
                    </p>
                    <hr>
                    <p>
                        机房:
                        <a id="idc"></a>
                    </p>
                    <hr>
                    <p>
                        更新时间:
                        <a id="time"></a>
                    </p>
                </div>
                <div class="modal-footer">

                </div>
            </div>
        </div>
    </div>

    <div class="box">
        <div class="row">

            <div class="col-sm-12">
                <div style="margin: 10px 0px 10px 0">
                    <div class="col-sm-2" style="padding-left: 0">
                        <a href="/asset/add">
                            <li class="btn btn-success"><b>添加设备</b></li>
                        </a>
                    </div>

                    <label>
                        <select name="idc" class="form-control m-b input-sm" id="idc-select" style="width: 60px">
                            <option value="" selected="">机房</option>
                            <option>-----</option>
                        </select>

                    </label>
                    <label>
                        <select name="type" class="form-control m-b input-sm" id="type-select" style="width: 80px">
                            <option value="" selected="">设备类型</option>
                            <option>-----</option>
                            <option value="server">server</option>
                            <option value="route">route</option>
                            <option value="swtich">swtich</option>
                            <option value="other">other</option>
                        </select>

                    </label>
                    <label>
                        <select name="idc" class="form-control m-b input-sm" id="busniss-select" style="width: 60px">
                            <option value="" selected="">产品线</option>
                            <option>-----</option>
                        </select>

                    </label>

                </div>

                <table class="table table-bordered table-hover dataTable"
                       role="grid"
                       aria-describedby="example2_info">

                    <thead>
                    <tr role="row">
                        <th>ID</th>
                        <th>主机名</th>
                        <th>业务线</th>
                        <th>管理员</th>
                        <th>IDC</th>
                        <th>状态</th>
                        <th>更新时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>

                </table>


            </div>
        </div>        <!-- nav-tabs-custom -->
    </div>
{% endblock %}


{% block js %}
    <script>
        $(document).ready(function () {
            $.getJSON("http://127.0.0.1:5000/api/idc", function (callback) {
                for (var item in callback) {
                    tmp = "<option>" + callback[item]['name'] + "</option>";
                    $('#idc-select').append(tmp)

                }
            });
             $.getJSON("http://127.0.0.1:5000/api/business", function (callback) {
                for (var item in callback) {
                    tmp = "<option>" + callback[item]['name'] + "</option>";
                    $('#busniss-select').append(tmp)

                }
            });
            $.getJSON("http://127.0.0.1:5000/api/assets", function (data) {
                var obj = data
                for (var item in obj) {
                    var name = obj[item].name;
                    var type = obj[item].type;
                    var sn = obj[item].sn;
                    var idc = obj[item].idc;
                    var business = obj[item].business_unit;
                    var status = obj[item].status;
                    var update_date = obj[item].update_date;

                    var html = "<tr>" + "<td>" + item + "</td>" + "<td>" + name + "</td>" + "<td>" + business + "</td>"
                            + "<td>" + "root" + "</td>" + "<td>" + idc + "</td>" + "<td>" + status + "</td>" + "<td>" + update_date + "</td>" + "<td id=" + item + ">" + " <a id=" + item + " " + 'class="fa fa-edit" onclick="Edit(this)" style="margin: 3px"data-toggle="modal"data-target="#modal-edit" type="button"></a> <a class="fa fa-refresh" style="margin: 3px"></a> <a class="fa fa-remove" style="margin: 3px" onclick="Del(this)"></a>' + "</td>" + "</tr>"
                    $("tbody").append(html)

                }
            })

        });

        function Edit(obj) {
            var id = $(obj).parent().attr('id')
            $.ajax({
                url: "http://127.0.0.1:5000/api/assets/" + id,
                type: 'GET',
                success: function (data) {
                    $("#modal-edit").modal();
                    var obj = data[id]
                    console.log(obj)
                    $('#host').text(obj.name);
                    $('#ip').text(obj.management_ip);
                    $('#idc').text(obj.idc)
                    $('#time').text(obj.update_date);
                    $('#sn').text(obj.sn);
                }
            })

        }
        function Del(obj) {
            if (confirm("确定删除?")) {
                var id = $(obj).parent().attr('id')
                $('#del_asset').removeClass('hidden');
                $.ajax({
                    url: "http://127.0.0.1:5000/api/assets/" + id,
                    type: 'DELETE',
                    success: function (data) {
                        console.log('ok')
                        location.reload()

                    }
                })
            }
        }
    </script>
{% endblock %}